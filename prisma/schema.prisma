// This is your Prisma schema file,
// learn more about it in the docs: https://pris.ly/d/prisma-schema

generator client {
  provider = "prisma-client-js"
  binaryTargets = ["native", "rhel-openssl-3.0.x"]
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

// --- MASTER DATA ---

model ColorMaster {
  id        String   @id @default(uuid())
  nameVI    String   // Vietnamese name (e.g., Trắng Ngọc Trai)
  nameEN    String?  // English name (e.g., Snow White Pearl)
  code      String   @unique // Internal code (e.g., GWP)
  hexCode   String?  // Display color (e.g., #FFFFFF)
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  carColors CarColor[]
}

// --- CORE CAR MODELS ---

model Car {
  id          String   @id @default(uuid())
  slug        String   @unique
  name        String
  brand       String?  @default("Kia")
  category    String?  // SUV, Sedan, Hatchback, etc.
  description String?  // HTML Rich Text Content
  isPublic    Boolean  @default(true)
  imageUrl    String?  // Main representative image (Avatar)

  // SEO Fields
  metaTitle       String?
  metaDescription String?

  variants  CarVariant[]
  documents CarDocument[]
  images    CarImage[] // General gallery images (not specific to color)

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
}

model CarVariant {
  id             String  @id @default(uuid())
  name           String  // e.g., "1.4 Turbo Luxury"
  price          Float
  promotionPrice Float?
  order          Int     @default(0)

  carId String
  car   Car    @relation(fields: [carId], references: [id], onDelete: Cascade)


  colors CarColor[]

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
}

model CarColor {
  id String @id @default(uuid())

  variantId String
  variant   CarVariant @relation(fields: [variantId], references: [id], onDelete: Cascade)

  colorMasterId String
  colorMaster   ColorMaster @relation(fields: [colorMasterId], references: [id])

  images CarImage[] // Specific images for this variant + color combination
  order  Int        @default(0)

  @@unique([variantId, colorMasterId])
}

model CarImage {
  id  String @id @default(uuid())
  url String

  // Image can belong to a specific CarColor (Variant specific) OR general Car gallery
  carColorId String?
  carColor   CarColor? @relation(fields: [carColorId], references: [id], onDelete: Cascade)

  carId String?
  car   Car?    @relation(fields: [carId], references: [id], onDelete: Cascade)

  createdAt DateTime @default(now())
}

model CarDocument {
  id   String @id @default(uuid())
  type String // "BROCHURE" | "SPEC_SHEET"
  name String
  url  String

  carId String
  car   Car    @relation(fields: [carId], references: [id], onDelete: Cascade)

  createdAt DateTime @default(now())
}



// --- USER & SYSTEM ---

model Lead {
  id      String  @id @default(uuid())
  type    String // "QUOTE", "CONTACT", "TEST_DRIVE"
  name    String
  phone   String
  email   String?
  message String?

  // Context
  carModel    String?
  date        String? // For Test Drive
  location    String?
  installment String? // "yes" or "no"

  status    String   @default("PENDING") // PENDING, PROCESSED, ARCHIVED
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
}

model User {
  id        String   @id @default(uuid())
  name      String?
  email     String   @unique
  password  String?
  role      String   @default("user") // "admin" | "user"
  image     String?
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
}

